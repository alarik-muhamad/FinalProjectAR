<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>PC Parts AR</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

    <style>
      body {
        margin: 0;
        overflow: hidden;
      }
    </style>
  </head>

  <body>
    <a-scene embedded arjs="sourceType: webcam;">
      <a-assets id="assetContainer"></a-assets>
      <a-entity id="markerContainer"></a-entity>
      <a-entity camera></a-entity>
    </a-scene>

    <script>
     
      //  LIST PC PARTS 
      const pcParts = [
        { id: "case", label: "CASE", pos: "-1 -3 0", rot: "-90 180 180", scale: "0.5 0.5 0.5"  },
        { id: "cpu", label: "CPU", pos: "0 0 0", rot: "0 -90 0", scale: "0.1 0.1 0.1" },
        { id: "fan", label: "FAN", pos: "0 0 0", rot: "0 0 0", scale: "20 20 20" },
        { id: "hdd", label: "HDD", pos: "0 0 0", rot: "180 180 0", scale: "0.5 0.5 0.5" },
        { id: "keyboard", label: "KEYBOARD", pos: "0 0 0", rot: "0 -90 0", scale: "0.1 0.1 0.1" },
        { id: "monitor", label: "MONITOR", pos: "0 1 0", rot: "-90 0 0", scale: "6 6 6" },
        { id: "motherboard", label: "MOTHERBOARD", pos: "0 1 0", rot: "0 90 0", scale: "2 2 2" },
        { id: "mouse", label: "MOUSE", pos: "0 0 0", rot: "0 -90 0", scale: "1 1 1"},
        { id: "psu", label: "PSU", pos: "0 0 0", rot: "90 0 180", scale: "0.1 0.1 0.1" },
        { id: "ram", label: "RAM", pos: "0 0 0", rot: "0 180 180", scale: "20 20 20" },
        { id: "ssd", label: "SSD", pos: "0 0 0", rot: "0 0 0", scale: "0.5 0.5 0.5" },
        { id: "gpu", label: "GPU", pos: "0 0 0", rot: "-90 0 0", scale: "1 1 1" },
      ];

      const assetContainer = document.getElementById("assetContainer");
      const markerContainer = document.getElementById("markerContainer");

      
      // AUTO-SIZING BACKGROUND 
      function updateBackgroundWidth(textEl, bgEl) {
        const value = textEl.getAttribute("value");
        const charWidth = 0.18; // adjust this if needed
        const padding = 0.4;

        const textWidth = value.length * charWidth;
        bgEl.setAttribute("width", textWidth + padding);
      }
      // 1. Generate assets + markers
    
      pcParts.forEach(part => {
        const {
          id,
          label,
          pos = "0 0 0",
          rot = "-90 0 0",
          scale = "1 1 1"
        } = part;

        // Add assets
        assetContainer.insertAdjacentHTML(
          "beforeend",
          `
            <a-asset-item id="model-${id}" src="models/${id}.glb"></a-asset-item>
            <audio id="audio-${id}" src="sounds/${id}.mp3" preload="auto"></audio>
          `
        );

        // Add marker
        markerContainer.insertAdjacentHTML(
          "beforeend",
          `
            <a-marker type="pattern" url="markers/${id}.patt" id="marker-${id}">
              
              <a-entity 
                gltf-model="#model-${id}"
                position="${pos}"
                rotation="${rot}"
                scale="${scale}">
              </a-entity>

              <!-- Label + background -->
              <a-entity id="label-${id}" position="0 0 2" rotation="-90 0 0">

                <a-plane 
                  id="bg-${id}" 
                  color="white" 
                  opacity="0.7"
                  height="0.5"
                  width="4"
                  position="0 0 0.01"
                </a-plane>

                <a-text 
                  id="text-${id}"
                  value="${label}"
                  align="center"
                  color="black"
                  position="0 0 0.05"
                  scale="2 2 2">
                </a-text>

              </a-entity>

              <a-sound id="sound-${id}" src="#audio-${id}" autoplay="false" volume="2"></a-sound>

            </a-marker>
          `
        );
      });

  
      // 2. Sound + background resizing triggers
      pcParts.forEach((part) => {
        const marker = document.getElementById(`marker-${part.id}`);

        marker.addEventListener("markerFound", () => {
          const sound = document.getElementById(`sound-${part.id}`);
          const textEl = document.getElementById(`text-${part.id}`);
          const bgEl = document.getElementById(`bg-${part.id}`);

          // play sound
          if (sound.components.sound) {
            sound.components.sound.playSound();
          }

          // auto resize label background
          updateBackgroundWidth(textEl, bgEl);
        });

        marker.addEventListener("markerLost", () => {
          const sound = document.getElementById(`sound-${part.id}`);
          if (sound.components.sound) {
            sound.components.sound.stopSound();
          }
        });
      });

    </script>

  </body>
</html>
