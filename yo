<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>PC Parts AR</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

    <style>
      body {
        margin: 0;
        overflow: hidden;
      }
    </style>
  </head>

  <body>
    <a-scene embedded arjs="sourceType: webcam;">
      <!-- Container for auto-generated assets -->
      <a-assets id="assetContainer"></a-assets>

      <!-- Container for auto-generated markers -->
      <a-entity id="markerContainer"></a-entity>

      <a-entity camera></a-entity>
    </a-scene>

    <script>
      // ================================
      //  LIST YOUR PC PARTS HERE
      // ================================
      const pcParts = [
        { id: "case", label: "CASE", pos: "0 0 0", rot: "-90 0 0", scale: "1 1 1"},
        { id: "cpu", label: "CPU", pos: "0 0 0", rot: "-90 0 0", scale: "1 1 1" },   
        { id: "fan", label: "FAN", pos: "0 0 0", rot: "-90 0 0", scale: "1 1 1" },
        { id: "hdd", label: "HDD", pos: "0 0 0", rot: "-90 0 0", scale: "1 1 1" },
        { id: "keyboard", label: "KEYBOARD" , pos: "0 0 0", rot: "-90 0 0", scale: "1 1 1"},
        { id: "monitor", label: "MONITOR" , pos: "0 0 0", rot: "-90 0 0", scale: "1 1 1"},
        { id: "motherboard", label: "MOTHERBOARD", pos: "0 0 0", rot: "-90 0 0", scale: "1 1 1" },
        { id: "mouse", label: "MOUSE", pos: "0 0 0", rot: "-90 0 0", scale: "1 1 1" },
        { id: "psu", label: "PSU", pos: "0 0 0", rot: "-90 0 0", scale: "1 1 1" },
        { id: "ram", label: "RAM" , pos: "0 0 0", rot: "-90 0 0", scale: "1 1 1"},
        { id: "ssd", label: "SSD", pos: "0 0 0", rot: "-90 0 0", scale: "1 1 1" },
        { id: "gpu", label: "GPU", pos: "0 0 0", rot: "-90 0 0", scale: "1 1 1" },
      ];

      const assetContainer = document.getElementById("assetContainer");
      const markerContainer = document.getElementById("markerContainer");

      pcParts.forEach((part) => {
        const { id, label } = part;

        // ----------------------------------
        // 1. Generate ASSETS (model + audio)
        // ----------------------------------
        assetContainer.insertAdjacentHTML(
          "beforeend",
          `
          <a-asset-item id="model-${id}" src="models/${id}.glb"></a-asset-item>
          <audio id="audio-${id}" src="sounds/${id}.mp3" preload="auto"></audio>
          `
        );

        // ----------------------------------
        // 2. Generate MARKER
        // ----------------------------------
        markerContainer.insertAdjacentHTML(
          "beforeend",
          `
            <a-marker type="pattern" url="markers/${id}.patt" id="marker-${id}">
              
             <a-entity 
        gltf-model="#model-${id}"
         position="${pos}"
        rotation="${rot}"
        scale="${scale}">
      </a-entity>

              <a-text
        value="${label}"
        position="0 0 1"
        align="center"
        color="black"
        rotation="-90 0 0"
        scale="2 2 2">
      </a-text>
              <a-sound id="sound-${id}" src="#audio-${id}" autoplay="false" volume="2"></a-sound>

            </a-marker>
          `
        );
      });

      // ----------------------------------
      // 3. Handle sound events for all markers
      // ----------------------------------
      pcParts.forEach((part) => {
        const marker = document.getElementById(`marker-${part.id}`);
        const sound = document.getElementById(`sound-${part.id}`);

        marker.addEventListener("markerFound", () => {
          sound.components.sound.playSound();
        });

        marker.addEventListener("markerLost", () => {
          sound.components.sound.stopSound();
        });
      });
    </script>
    <script>
      AFRAME.registerComponent("autoscale", {
        schema: {
          target: { default: 1 }, // target size in meters (tweak as needed)
        },
        init: function () {
          this.el.addEventListener("model-loaded", () => {
            const mesh = this.el.getObject3D("mesh");
            if (!mesh) return;

            // Compute bounding box of model
            const box = new THREE.Box3().setFromObject(mesh);
            const size = new THREE.Vector3();
            box.getSize(size);

            const maxDim = Math.max(size.x, size.y, size.z);
            const scale = this.data.target / maxDim;

            this.el.setAttribute("scale", `${scale} ${scale} ${scale}`);
          });
        },
      });
    </script>
  </body>
</html>
